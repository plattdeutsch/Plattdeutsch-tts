# Model storage configuration
# Creates persistent directory for ML models that survives deployments

commands:
  01_create_model_dir:
    command: |
      mkdir -p /var/app/models/active
      mkdir -p /var/app/models/inactive
      chown -R webapp:webapp /var/app/models
      chmod -R 755 /var/app/models
    ignoreErrors: false

  02_create_temp_dir:
    command: |
      mkdir -p /var/app/current/backend/temp
      chown -R webapp:webapp /var/app/current/backend/temp 2>/dev/null || true
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_fix_permissions.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Fix permissions after deployment
      mkdir -p /var/app/models/active
      mkdir -p /var/app/models/inactive
      chown -R webapp:webapp /var/app/models
      chmod -R 755 /var/app/models
      
      # Ensure temp directory exists
      mkdir -p /var/app/current/backend/temp
      chown -R webapp:webapp /var/app/current/backend/temp
